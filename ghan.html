<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghan's Algorithm</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- CSS Variables (Tema Hybrid Profesional Terang-Gelap) --- */
        :root {
            --primary: #2563eb; --primary-dark: #1e40af;
            --accent-success: #059669; --accent-error: #dc2626;
            --bg-body: #f1f5f9; --bg-card: #ffffff; --bg-input: #f8fafc; --bg-log: #1e293b;
            --text-main: #0f172a; --text-muted: #64748b; --text-on-dark: #f1f5f9;
            --border: #e2e8f0; --radius: 12px;
            --shadow-card: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif; background-color: var(--bg-body); color: var(--text-main);
            min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px 20px;
        }

        .container { width: 100%; max-width: 1000px; }

        header { text-align: center; margin-bottom: 40px; }
        header h1 { font-size: 2.2rem; font-weight: 700; color: var(--primary-dark); letter-spacing: -0.5px; display: flex; align-items: center; justify-content: center; gap: 15px; }
        header h1 i { color: var(--primary); }
        header p { color: var(--text-muted); margin-top: 10px; font-size: 1.05rem; }

        .grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 35px; align-items: stretch; }

        .card {
            background: var(--bg-card); border-radius: var(--radius); padding: 35px;
            box-shadow: var(--shadow-card); border: 1px solid var(--border); display: flex; flex-direction: column;
        }
        .card-header { display: flex; align-items: center; gap: 12px; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 2px solid var(--border); }
        .card-header h2 { font-size: 1.35rem; font-weight: 600; color: var(--text-main); }
        .card-header i { font-size: 1.5rem; color: var(--primary); }

        .form-group { margin-bottom: 25px; }
        .form-label { display: block; margin-bottom: 10px; font-weight: 500; font-size: 0.95rem; color: var(--text-main); }
        .input-group { position: relative; display: flex; align-items: center; }
        .input-icon { position: absolute; left: 16px; color: var(--text-muted); z-index: 2; transition: 0.3s; }
        .form-input {
            width: 100%; background: var(--bg-input); border: 2px solid var(--border); padding: 16px 20px 16px 50px;
            border-radius: 10px; color: var(--text-main); font-family: 'Fira Code', monospace; font-size: 1rem; transition: all 0.3s ease;
        }
        .form-input:focus { border-color: var(--primary); outline: none; background: #fff; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }
        .form-input:focus + .input-icon { color: var(--primary); }

        .btn {
            width: 100%; padding: 18px; border: none; border-radius: 10px; font-weight: 700; font-size: 1rem;
            cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; gap: 12px;
        }
        .btn-primary { background: linear-gradient(145deg, var(--primary), var(--primary-dark)); color: white; box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2); }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3); }
        .btn-primary:active:not(:disabled) { transform: translateY(0); }
        .btn-primary:disabled { opacity: 0.7; cursor: wait; }
        .btn-secondary { background: var(--bg-body); color: var(--text-main); border: 2px solid var(--border); margin-top: 25px; }
        .btn-secondary:hover { border-color: var(--text-muted); background: #e2e8f0; }

        .state-container { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; }
        .hidden { display: none !important; }

        .initial-state { text-align: center; color: var(--text-muted); padding: 40px; }
        .initial-state i { font-size: 5rem; margin-bottom: 25px; color: var(--border); }
        .initial-state h3 { color: var(--text-main); margin-bottom: 10px; }

        .calculating-state {
            font-family: 'Fira Code', monospace; font-size: 0.9rem; background: var(--bg-log); color: var(--text-on-dark);
            padding: 25px; border-radius: 10px; max-height: 400px; overflow-y: auto; border: 2px solid var(--primary);
        }
        .log-entry { margin-bottom: 12px; opacity: 0; transform: translateY(10px); animation: fadeInUp 0.5s forwards; border-left: 3px solid transparent; padding-left: 10px; }
        .log-timestamp { color: #64748b; margin-right: 10px; font-size: 0.8rem; }
        .log-info { color: #93c5fd; border-left-color: #93c5fd; }
        .log-success { color: #4ade80; border-left-color: #4ade80; }
        .log-error { color: #f87171; border-left-color: #f87171; }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        .result-metrics { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .metric-box {
            background: var(--bg-input); padding: 20px; border-radius: 12px; border: 1px solid var(--border);
            border-top: 4px solid var(--primary); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }
        .metric-label { font-size: 0.9rem; color: var(--text-muted); display: block; margin-bottom: 8px; font-weight: 600; }
        .metric-value { font-family: 'Fira Code', monospace; font-size: 1.4rem; font-weight: 700; color: var(--text-main); }
        .metric-status { font-size: 0.85rem; margin-top: 8px; font-weight: 600; }
        /* Style baru untuk info stabilitas */
        .stability-info { margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border); font-size: 0.9rem; color: var(--text-muted); }
        .stability-percentage { font-weight: 700; color: var(--primary); }

        .viz-wrapper {
            width: 100%; flex-grow: 1; min-height: 350px; background: #ffffff; border-radius: 12px;
            border: 2px solid var(--border); position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center;
        }
        canvas { background: #ffffff; display: block; width: 100%; height: 100%; }

        #validationBanner {
            padding: 18px; border-radius: 10px; margin-bottom: 25px; font-weight: 600; display: none;
            align-items: center; gap: 15px; font-size: 1rem;
        }
        .banner-success { background: #ecfdf5; color: var(--accent-success); border: 2px solid #a7f3d0; }
        .banner-error { background: #fef2f2; color: var(--accent-error); border: 2px solid #fecaca; }

        @media (max-width: 968px) {
            .grid-layout { grid-template-columns: 1fr; gap: 25px; }
            body { padding: 20px 15px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1><i class="fas fa-drafting-compass"></i> Ghan's Algorithm</h1>
            <p>Algoritma ini akan memproses data cevian untuk menemukan koordinat desain yang secara geometris menentukan titik ekuilibrium struktural sistem.</p>
        </header>

        <div class="grid-layout">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-sliders-h"></i> <h2>Parameter</h2>
                </div>
                <form id="calcForm">
                    <div class="form-group">
                        <label class="form-label">Masukkan Nilai C</label>
                        <div class="input-group"><i class="fas fa-ruler-vertical input-icon"></i><input type="number" id="c" class="form-input" step="any" placeholder="C" required></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Masukkan Nilai Cx</label>
                        <div class="input-group"><i class="fas fa-ruler-horizontal input-icon"></i><input type="number" id="cx" class="form-input" step="any" placeholder="Cx" required></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Masukkan Nilai Cy</label>
                        <div class="input-group"><i class="fas fa-ruler-horizontal input-icon"></i><input type="number" id="cy" class="form-input" step="any" placeholder="Cy" required></div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="calcBtn"><i class="fas fa-calculator"></i>Jalankan Algoritma !</button>
                </form>
            </div>

            <div class="card" id="resultCard">
                <div class="card-header">
                    <i class="fas fa-project-diagram"></i> <h2>Hasil & Visualisasi</h2>
                </div>
                <div id="stateInitial" class="state-container initial-state">
                    <i class="fas fa-cube"></i> <h3>Algoritma Siap</h3> <p>Masukkan data nilai cevian terlebih dahulu sebelum memulai</p>
                </div>
                <div id="stateCalculating" class="state-container hidden">
                    <div class="calculating-state" id="calculationLog"></div>
                </div>
                <div id="stateResults" class="state-container hidden">
                    <div id="validationBanner"></div>
                    <div class="result-metrics">
                        <div class="metric-box" style="border-top-color: var(--primary);">
                            <span class="metric-label"><i class="fas fa-percent"></i> Rasio Ghan (G)</span> <span class="metric-value" id="valG">-</span> <div class="metric-status" id="statusG"></div>
                        </div>
                        <div class="metric-box" style="border-top-color: var(--accent-success);">
                            <span class="metric-label"><i class="fas fa-crosshairs"></i> Koordinat (n)</span> <span class="metric-value" id="valN">-</span> <div class="metric-status" id="statusN"></div>
                            <div class="stability-info" id="stabilityInfo"></div>
                        </div>
                    </div>
                    <div class="viz-wrapper"><canvas id="ghanCanvas"></canvas></div>
                    <button class="btn btn-secondary" id="resetBtn"><i class="fas fa-undo-alt"></i> Hitung Lagi!</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('calcForm'), calcBtn = document.getElementById('calcBtn'), resetBtn = document.getElementById('resetBtn');
            const stateInitial = document.getElementById('stateInitial'), stateCalculating = document.getElementById('stateCalculating'), stateResults = document.getElementById('stateResults'), calculationLog = document.getElementById('calculationLog');
            const validationBanner = document.getElementById('validationBanner'), valG = document.getElementById('valG'), statusG = document.getElementById('statusG'), valN = document.getElementById('valN'), statusN = document.getElementById('statusN');
            const stabilityInfo = document.getElementById('stabilityInfo'); // Referensi baru
            const canvas = document.getElementById('ghanCanvas'), ctx = canvas.getContext('2d');

            // --- Constants ---
            // Batas Interval Ghan yang Baru: [sqrt(2)/4, 1/2]
            const G_MIN = Math.sqrt(2) / 4; // ~0.35355
            const G_MAX = 0.5;
            const ANIMATION_DELAY_MS = 800; // Sedikit diperlambat untuk efek dramatis

            form.addEventListener('submit', (e) => { e.preventDefault(); startCalculationSequence(); });
            resetBtn.addEventListener('click', resetApplication);

            const delay = ms => new Promise(res => setTimeout(res, ms));
            const getTimestamp = () => new Date().toLocaleTimeString('id-ID', { hour12: false, minute:'2-digit', second:'2-digit' });

            function addLogEntry(type, message) {
                const entry = document.createElement('div');
                entry.className = `log-entry log-${type}`;
                entry.innerHTML = `<span class="log-timestamp">[${getTimestamp()}]</span> ${message}`;
                calculationLog.appendChild(entry);
                calculationLog.scrollTop = calculationLog.scrollHeight;
            }

            function switchState(stateName) {
                [stateInitial, stateCalculating, stateResults].forEach(el => el.classList.add('hidden'));
                document.getElementById(`state${stateName}`).classList.remove('hidden');
            }

            // Setup Canvas Resolution untuk High DPI (Retina Display)
            function setupCanvasResolution() {
                const dpr = window.devicePixelRatio || 1;
                // Ambil ukuran elemen canvas di DOM (CSS pixels)
                const rect = canvas.getBoundingClientRect();
                // Set ukuran buffer canvas (physical pixels)
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                // Normalisasi sistem koordinat canvas
                ctx.scale(dpr, dpr);
                // Kembalikan dimensi logis untuk penggambaran
                return { width: rect.width, height: rect.height };
            }

            async function startCalculationSequence() {
                const c = parseFloat(document.getElementById('c').value), cx = parseFloat(document.getElementById('cx').value), cy = parseFloat(document.getElementById('cy').value);
                if (isNaN(c) || isNaN(cx) || isNaN(cy) || c <= 0 || cx <= 0 || cy <= 0) { alert("Error Input: Harap masukkan nilai positif."); return; }

                calcBtn.disabled = true; calcBtn.innerHTML = '<i class="fas fa-cog fa-spin"></i> Memproses Algoritma...'; calculationLog.innerHTML = ''; switchState('Calculating');

                try {
                    addLogEntry('info', 'Memulai Algoritma Ghan...'); await delay(ANIMATION_DELAY_MS);
                    addLogEntry('info', `Input Diterima: c=${c.toFixed(2)}, cx=${cx.toFixed(2)}, cy=${cy.toFixed(2)}`); await delay(ANIMATION_DELAY_MS);

                    addLogEntry('info', 'Menghitung magnitude vektor samping (√S)...');
                    const S = (cx * cx) + (cy * cy); const sqrtS = Math.sqrt(S);
                    await delay(ANIMATION_DELAY_MS);
                    addLogEntry('success', `Magnitude √S berhasil dihitung: ${sqrtS.toFixed(4)}`);

                    await delay(ANIMATION_DELAY_MS);
                    addLogEntry('info', 'Menghitung Rasio Ghan (G = c / √S)...');
                    const G = c / sqrtS;
                    await delay(ANIMATION_DELAY_MS);
                    addLogEntry('success', `Rasio Ghan diperoleh: ${G.toFixed(6)}`);

                    await delay(ANIMATION_DELAY_MS);
                    // Update pesan log dengan interval baru
                    addLogEntry('info', `Memeriksa Domain Ghan [${G_MIN.toFixed(4)}, ${G_MAX.toFixed(4)}]...`);
                    await delay(ANIMATION_DELAY_MS);

                    let n = null, isValid = false;
                    // Menggunakan toleransi epsilon kecil untuk perbandingan float dan interval baru
                    if (G >= G_MIN - 0.00001 && G <= G_MAX + 0.00001) {
                        isValid = true;
                        addLogEntry('success', 'Validasi Berhasil! Rasio Ghan berada dalam domain yang valid.');
                        await delay(ANIMATION_DELAY_MS);
                        addLogEntry('info', 'Mengubah nilai Ghan menjadi nilai koordinat desain (n)...');
                        const term = (1 / (4 * G * G)) - 1; n = Math.sqrt(Math.max(0, term));
                        await delay(ANIMATION_DELAY_MS);
                        addLogEntry('success', `Solusi Ditemukan!: Koordinat Desain n ≈ ${n.toFixed(4)}`);
                    } else {
                        addLogEntry('error', 'Validasi Gagal! Rasio Ghan berada di luar domain yang memenuhi aturan.');
                    }

                    await delay(ANIMATION_DELAY_MS);
                    addLogEntry('info', 'Membuat gambar..');
                    await delay(600);

                    displayResults(isValid, G, n, cx, cy);
                    switchState('Results');
                    // Panggil fungsi gambar setelah state berubah agar canvas visible dan ukurannya benar
                    requestAnimationFrame(() => {
                        drawCoordinateSystemHD(ctx, cx, cy, n, isValid);
                    });

                } catch (e) {
                    console.error(e); addLogEntry('error', 'FATAL ERROR: ' + e.message); calcBtn.disabled = false; calcBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Terjadi Kesalahan';
                }
            }

            // Fungsi baru untuk menghitung persentase stabilitas
            function calculateStabilityPercentage(n) {
                // Jarak dari titik optimal 0.5
                const deviation = Math.abs(n - 0.5);
                // Normalisasi: 0.5 adalah penyimpangan maksimal (ke 0 atau 1)
                // Persentase = (1 - (penyimpangan / penyimpangan_maks)) * 100
                const percentage = (1 - (deviation / 0.5)) * 100;
                return percentage.toFixed(2);
            }

            // Fungsi baru untuk mendapatkan interpretasi teks dari persentase
            function getStabilityInterpretation(percentage) {
                const p = parseFloat(percentage);
                if (p === 100) return "Sempurna";
                if (p >= 90) return "Sangat Tinggi";
                if (p >= 75) return "Tinggi";
                if (p >= 50) return "Sedang";
                if (p >= 25) return "Rendah";
                return "Sangat Rendah";
            }

            function displayResults(isValid, G, n, cx, cy) {
                valG.textContent = G.toFixed(4); statusG.textContent = isValid ? "Domain Valid" : "Domain Invalid"; statusG.style.color = isValid ? "var(--accent-success)" : "var(--accent-error)";
                if (isValid) {
                    validationBanner.className = "banner-success"; validationBanner.innerHTML = `<i class="fas fa-check-circle fa-lg"></i><div><strong>Perhitungan Sukses.</strong><br>Koordinat desain (n) berhasil di temukan dari data cevian.</div>`; validationBanner.style.display = "flex";
                    valN.textContent = n.toFixed(4);
                    let statusText = "";
                    if (Math.abs(n - 0.5) < 0.015) statusText = "";
                    else if (Math.abs(n - 1/3) < 0.015) statusText = "";
                    else if (n < 0.1) statusText = "";
                    statusN.textContent = statusText; statusN.style.color = "var(--accent-success)";

                    // Hitung dan tampilkan informasi stabilitas
                    const percentage = calculateStabilityPercentage(n);
                    const interpretation = getStabilityInterpretation(percentage);
                    stabilityInfo.innerHTML = `Persentase Kestabilan: <span class="stability-percentage">${percentage}%</span><br> (${interpretation})`;

                } else {
                    validationBanner.className = "banner-error"; validationBanner.innerHTML = `<i class="fas fa-times-circle fa-lg"></i><div><strong>Perhitungan Gagal.</strong><br>Data input tidak memenuhi aturan Ghan.</div>`; validationBanner.style.display = "flex";
                    valN.textContent = ""; statusN.textContent = "Tidak ada solusi koordinat yang memenuhi"; statusN.style.color = "var(--accent-error)";
                    stabilityInfo.innerHTML = ""; // Kosongkan jika tidak valid
                }
                calcBtn.innerHTML = '<i class="fas fa-check-double"></i> Analisis Selesai!';
            }

            function resetApplication() {
                // form.reset(); // Baris ini dihapus agar data input tidak hilang
                calcBtn.disabled = false; calcBtn.innerHTML = '<i class="fas fa-calculator"></i> Jalankan Analisis & Visualisasi'; validationBanner.style.display = "none"; ctx.clearRect(0, 0, canvas.width, canvas.height); switchState('Initial');
                stabilityInfo.innerHTML = ""; // Kosongkan info stabilitas saat reset
            }

            function drawCoordinateSystemHD(ctx, baseW, baseH, n, isValid) {
                // 1. Dapatkan dimensi kanvas logis yang benar setelah penskalaan DPI
                const canvasDims = setupCanvasResolution();
                const w = canvasDims.width;
                const h = canvasDims.height;
                
                ctx.clearRect(0, 0, w, h); // Clear canvas putih menggunakan dimensi logis

                // 2. Setup Skala & Margin (Agar gambar di tengah & proporsional)
                const padding = 70;
                const drawW = w - padding * 2;
                const drawH = h - padding * 2;
                // Skala dinamis berdasarkan input terbesar
                const scale = Math.min(drawW / (baseW * 1.1), drawH / (baseH * 1.1));

                const originX = padding;
                const originY = h - padding; // Y naik ke atas

                // Transformasi Fungsi
                const toCX = (x) => originX + (x * scale);
                const toCY = (y) => originY - (y * scale);

                // 2. Gambar GRID & SUMBU (Tampilan Profesional Teknis)
                ctx.lineWidth = 1; ctx.strokeStyle = '#e2e8f0'; ctx.beginPath();
                for (let i = originX; i < w - 20; i += 40) { ctx.moveTo(i, originY); ctx.lineTo(i, 20); }
                for (let i = originY; i > 20; i -= 40) { ctx.moveTo(originX, i); ctx.lineTo(w - 20, i); }
                ctx.stroke();

                ctx.lineWidth = 2; ctx.strokeStyle = '#475569'; ctx.beginPath();
                ctx.moveTo(originX, h); ctx.lineTo(originX, 20); ctx.lineTo(originX - 5, 25); ctx.moveTo(originX, 20); ctx.lineTo(originX + 5, 25);
                ctx.moveTo(0, originY); ctx.lineTo(w - 20, originY); ctx.lineTo(w - 25, originY - 5); ctx.moveTo(w - 20, originY); ctx.lineTo(w - 25, originY + 5);
                ctx.stroke();

                ctx.fillStyle = '#64748b'; ctx.font = '600 14px Poppins';
                ctx.fillText('(0,0)', originX - 40, originY + 25);
                ctx.fillText('x', w - 130, originY + 25);
                ctx.fillText('y', originX - 40, 30);

                if (!isValid) {
                    ctx.fillStyle = 'rgba(220, 38, 38, 0.1)'; ctx.fillRect(originX, 20, w - originX - 20, originY - 20);
                    ctx.strokeStyle = '#dc2626'; ctx.lineWidth = 3; ctx.beginPath();
                    ctx.moveTo(originX + 50, originY - 50); ctx.lineTo(w - 70, 70); ctx.moveTo(w - 70, originY - 50); ctx.lineTo(originX + 50, 70); ctx.stroke();
                    ctx.fillStyle = '#dc2626'; ctx.font = '700 20px Poppins'; ctx.textAlign = 'center';
                    ctx.fillText("Tidak Ada Visualisasi!", (originX + w) / 2, h / 2);
                    ctx.font = '500 14px Poppins'; ctx.fillText("Data input melanggar aturan Ghan.", (originX + w) / 2, h / 2 + 25);
                    return;
                }

                // 3. Gambar SEGITIGA & CEVIAN (HD & Cerah)
                const PA = { x: 0, y: baseH }; const PB = { x: baseW, y: 0 }; const PC = { x: 0, y: 0 };
                ctx.fillStyle = 'rgba(37, 99, 235, 0.08)'; ctx.beginPath();
                ctx.moveTo(toCX(PC.x), toCY(PC.y)); ctx.lineTo(toCX(PB.x), toCY(PB.y)); ctx.lineTo(toCX(PA.x), toCY(PA.y)); ctx.closePath(); ctx.fill();
                ctx.strokeStyle = '#2563eb'; ctx.lineWidth = 3; ctx.stroke();

                const PA_prime = { x: n * baseW, y: 0 }; const PB_prime = { x: 0, y: n * baseH };
                ctx.lineWidth = 2; ctx.setLineDash([8, 5]);
                ctx.strokeStyle = '#f59e0b'; ctx.beginPath(); ctx.moveTo(toCX(PA.x), toCY(PA.y)); ctx.lineTo(toCX(PA_prime.x), toCY(PA_prime.y)); ctx.stroke();
                ctx.strokeStyle = '#10b981'; ctx.beginPath(); ctx.moveTo(toCX(PB.x), toCY(PB.y)); ctx.lineTo(toCX(PB_prime.x), toCY(PB_prime.y)); ctx.stroke();
                ctx.setLineDash([]);

                // 4. MARKERS & LABELS (Jelas & Terbaca)
                const drawLabel = (pt, text, color, align = 'center') => {
                    const cx = toCX(pt.x); const cy = toCY(pt.y);
                    ctx.beginPath(); ctx.arc(cx, cy, 5, 0, Math.PI * 2); ctx.fillStyle = color; ctx.fill();
                    ctx.font = '600 12px Fira Code'; ctx.textAlign = align; ctx.strokeStyle = 'white'; ctx.lineWidth = 3; ctx.strokeText(text, cx, cy - 12); ctx.fillStyle = color; ctx.fillText(text, cx, cy - 12);
                };
                drawLabel(PA, `A(0, ${baseH})`, '#1e40af'); drawLabel(PB, `B(${baseW}, 0)`, '#1e40af');
                drawLabel(PA_prime, `A'(n=${n.toFixed(2)})`, '#d97706', 'left'); drawLabel(PB_prime, `B'(n=${n.toFixed(2)})`, '#059669', 'right');

                const ix = (n * baseW) / (n + 1); const iy = (n * baseH) / (n + 1); const cix = toCX(ix); const ciy = toCY(iy);
                const grad = ctx.createRadialGradient(cix, ciy, 2, cix, ciy, 15); grad.addColorStop(0, 'rgba(245, 158, 11, 1)'); grad.addColorStop(1, 'rgba(245, 158, 11, 0)');
                ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(cix, ciy, 15, 0, Math.PI * 2); ctx.fill();
                ctx.beginPath(); ctx.arc(cix, ciy, 6, 0, Math.PI * 2); ctx.fillStyle = '#fff'; ctx.fill(); ctx.strokeStyle = '#d97706'; ctx.lineWidth = 2; ctx.stroke();
                ctx.font = 'bold 14px Poppins'; ctx.fillStyle = '#b45309'; ctx.textAlign = 'left'; ctx.fillText("Titik Stabilitas", cix + 15, ciy);
                ctx.font = '12px Fira Code'; ctx.fillStyle = '#64748b'; ctx.fillText(`(${ix.toFixed(2)}, ${iy.toFixed(2)})`, cix + 15, ciy + 18);
            }
        });
    </script>
</body>
</html>